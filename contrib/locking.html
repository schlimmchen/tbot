

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>tbot_contrib.locking &mdash; tbot 0.9.0-12-gbc85925 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="tbot_contrib.swupdate" href="swupdate.html" />
    <link rel="prev" title="tbot_contrib.connector" href="connector.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/tbot-logo-white.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.9.0-12-gbc85925
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../recipes.html">Recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../context.html">Context</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration.html">Migrating from tbot 0.7.1</a></li>
</ul>
<p class="caption"><span class="caption-text">Core Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules/main.html"><code class="docutils literal notranslate"><span class="pre">tbot</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/log.html"><code class="docutils literal notranslate"><span class="pre">tbot.log</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/machine.html"><code class="docutils literal notranslate"><span class="pre">tbot.machine</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/machine_linux.html"><code class="docutils literal notranslate"><span class="pre">tbot.machine.linux</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/machine_board.html"><code class="docutils literal notranslate"><span class="pre">tbot.machine.board</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/machine_connector.html"><code class="docutils literal notranslate"><span class="pre">tbot.machine.connector</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/machine_shell.html"><code class="docutils literal notranslate"><span class="pre">tbot.machine.shell</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/machine_channel.html"><code class="docutils literal notranslate"><span class="pre">tbot.machine.channel</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/role.html"><code class="docutils literal notranslate"><span class="pre">tbot.role</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/selectable.html"><code class="docutils literal notranslate"><span class="pre">tbot.selectable</span></code></a></li>
</ul>
<p class="caption"><span class="caption-text">Testcase Modules</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../modules/tc.html"><code class="docutils literal notranslate"><span class="pre">tbot.tc</span></code> - Builtin Testcases</a></li>
<li class="toctree-l1"><a class="reference internal" href="connector.html"><code class="docutils literal notranslate"><span class="pre">tbot_contrib.connector</span></code></a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#"><code class="docutils literal notranslate"><span class="pre">tbot_contrib.locking</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="swupdate.html"><code class="docutils literal notranslate"><span class="pre">tbot_contrib.swupdate</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="timing.html"><code class="docutils literal notranslate"><span class="pre">tbot_contrib.timing</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html"><code class="docutils literal notranslate"><span class="pre">tbot_contrib.utils</span></code></a></li>
</ul>
<p class="caption"><span class="caption-text">Info</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../CHANGELOG.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributing to tbot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LICENSE.html">License</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">tbot</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><code class="docutils literal notranslate"><span class="pre">tbot_contrib.locking</span></code></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/contrib/locking.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">

           <div itemprop="articleBody">
            
  <span class="target" id="module-tbot_contrib.locking"></span><div class="section" id="tbot-contrib-locking">
<h1><code class="docutils literal notranslate"><span class="pre">tbot_contrib.locking</span></code><a class="headerlink" href="#tbot-contrib-locking" title="Permalink to this headline">¶</a></h1>
<p>This module provide utilities for managing “locks” on the lab-host.  This can be
used in setups where multiple users might try accessing the same host at the
same time.  Instead of cryptic errors due to busy devices or, even worse, bad
behavior because of two running tbot testcases interfering, only one can ever
access, for example, a board.</p>
<p>To facilitate this, two parts are needed:</p>
<ol class="arabic simple">
<li><p>The lab-host configuration must be augmented with the
<a class="reference internal" href="#tbot_contrib.locking.LockManager" title="tbot_contrib.locking.LockManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">LockManager</span></code></a> mixin.  This provides a locking
“implementation” which board machines can hook into.</p></li>
<li><p>To enable locking for a certain board, it should inherit the
<a class="reference internal" href="#tbot_contrib.locking.MachineLock" title="tbot_contrib.locking.MachineLock"><code class="xref py py-class docutils literal notranslate"><span class="pre">MachineLock</span></code></a> mixin.</p></li>
</ol>
<dl class="py class">
<dt id="tbot_contrib.locking.MachineLock">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">tbot_contrib.locking.</span></code><code class="sig-name descname"><span class="pre">MachineLock</span></code><a class="reference internal" href="../_modules/tbot_contrib/locking.html#MachineLock"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tbot_contrib.locking.MachineLock" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">tbot.machine.machine.PreConnectInitializer</span></code></p>
<p>This is the initializer that is inherited by the board machine.  It just
calls the lab-host’s locking implementation.</p>
<dl class="py attribute">
<dt id="tbot_contrib.locking.MachineLock.lock_expiry">
<code class="sig-name descname"><span class="pre">lock_expiry</span></code><em class="property"><span class="pre">:</span> <span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><span class="pre">int</span></a><span class="p"><span class="pre">]</span></span></em><em class="property"> <span class="pre">=</span> <span class="pre">None</span></em><a class="headerlink" href="#tbot_contrib.locking.MachineLock.lock_expiry" title="Permalink to this definition">¶</a></dt>
<dd><p>Timeout after which the lock should be considered expired.</p>
<p>This provides a safeguard in case a testcase crashes without unlocking
a lock - After the lock has expired, it will be considered unlocked again
and a new testcase can acquire it.</p>
</dd></dl>

<dl class="py method">
<dt id="tbot_contrib.locking.MachineLock.lock_name">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">lock_name</span></code><a class="headerlink" href="#tbot_contrib.locking.MachineLock.lock_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Prefix from which lock file name is derived.</p>
<p>Defaults to the machine’s name: <code class="docutils literal notranslate"><span class="pre">self.name</span></code>.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="tbot_contrib.locking.LockManager">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">tbot_contrib.locking.</span></code><code class="sig-name descname"><span class="pre">LockManager</span></code><a class="reference internal" href="../_modules/tbot_contrib/locking.html#LockManager"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tbot_contrib.locking.LockManager" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">tbot_contrib.locking.LockManagerBase</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">tbot.machine.machine.PostShellInitializer</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">tbot.machine.linux.linux_shell.LinuxShell</span></code></p>
<p>Machine locking implementation based on Python, bash and flock(1)</p>
<dl class="py attribute">
<dt id="tbot_contrib.locking.LockManager.lock_checkpid">
<code class="sig-name descname"><span class="pre">lock_checkpid</span></code><em class="property"><span class="pre">:</span> <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><span class="pre">bool</span></a></em><em class="property"> <span class="pre">=</span> <span class="pre">True</span></em><a class="headerlink" href="#tbot_contrib.locking.LockManager.lock_checkpid" title="Permalink to this definition">¶</a></dt>
<dd><p>Make tbot check whether the PID associated with a lockfile is still alive.</p>
<p>If this check is enabled and the PID is found, the lock will be considered
active, even if it would otherwise have been assumed expired.</p>
</dd></dl>

<dl class="py method">
<dt id="tbot_contrib.locking.LockManager.lock_dir">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">lock_dir</span></code><a class="headerlink" href="#tbot_contrib.locking.LockManager.lock_dir" title="Permalink to this definition">¶</a></dt>
<dd><p>The directory where tbot locks are stored.</p>
<p>Defaults to <code class="docutils literal notranslate"><span class="pre">/tmp/tbot-locks</span></code>.  If this directory does not exist, it
will be created and given <code class="docutils literal notranslate"><span class="pre">0777</span></code> access mode to allow all users to
write lockfiles to it.</p>
</dd></dl>

<dl class="py method">
<dt id="tbot_contrib.locking.LockManager.request_machine_lock">
<code class="sig-name descname"><span class="pre">request_machine_lock</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expiry</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><span class="pre">int</span></a><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><span class="pre">bool</span></a><a class="reference internal" href="../_modules/tbot_contrib/locking.html#LockManager.request_machine_lock"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tbot_contrib.locking.LockManager.request_machine_lock" title="Permalink to this definition">¶</a></dt>
<dd><p>Request lock for machine named <code class="docutils literal notranslate"><span class="pre">name</span></code>.</p>
<p>This method will usually be called via the
<a class="reference internal" href="#tbot_contrib.locking.MachineLock" title="tbot_contrib.locking.MachineLock"><code class="xref py py-class docutils literal notranslate"><span class="pre">MachineLock</span></code></a> mixin.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – Name of the lock to be acquired.</p></li>
<li><p><strong>expiry</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – Optional timeout after which a lock should ‘expire’.
When a lock is expired, followup locking requests will treat it as
unlocked.  This can be used as a safeguard if a testcase fails
without unlocking.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">True</span></code> if the lock has been acquired successfully and
<code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="tbot_contrib.locking.LockManager.release_machine_lock">
<code class="sig-name descname"><span class="pre">release_machine_lock</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)"><span class="pre">None</span></a><a class="reference internal" href="../_modules/tbot_contrib/locking.html#LockManager.release_machine_lock"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tbot_contrib.locking.LockManager.release_machine_lock" title="Permalink to this definition">¶</a></dt>
<dd><p>Release lock for machine named <code class="docutils literal notranslate"><span class="pre">name</span></code>.</p>
<p>If not explicitly released, the
<a class="reference internal" href="#tbot_contrib.locking.LockManager" title="tbot_contrib.locking.LockManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">LockManager</span></code></a> will automatically unlock
all locks it is holding when the lab-host machine is deinitialized.</p>
</dd></dl>

<dl class="py method">
<dt id="tbot_contrib.locking.LockManager.get_active_machine_locks">
<code class="sig-name descname"><span class="pre">get_active_machine_locks</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; <span class="pre">Set</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><span class="pre">str</span></a><span class="p"><span class="pre">]</span></span><a class="reference internal" href="../_modules/tbot_contrib/locking.html#LockManager.get_active_machine_locks"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tbot_contrib.locking.LockManager.get_active_machine_locks" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the active machine locks managed by this LockManager instance.</p>
</dd></dl>

</dd></dl>

</div>


           </div>
           
          </div>
    <a href="https://github.com/Rahix/tbot">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub">
    </a>

          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="swupdate.html" class="btn btn-neutral float-right" title="tbot_contrib.swupdate" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="connector.html" class="btn btn-neutral float-left" title="tbot_contrib.connector" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019, Rahix.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>